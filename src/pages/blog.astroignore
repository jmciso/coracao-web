---
import Article from '../components/Article.astro';
import Hero from '../components/Hero.astro';
import Layout from '../layouts/Layout.astro';
import { formatRelativeTime, getDirectusClient } from '../utils/utils';

const directus = await getDirectusClient()
const response = await directus.items("articles").readByQuery({
  fields: ["*", "user_created", "user_created.first_name", "user_created.last_name"],
  filter: { status: { _eq: "published" } },
  sort: "-publish_date",
})
const formattedArticles = response?.data.map((article) => {
  return {
    ...article,
    publish_date: formatRelativeTime(new Date(article.publish_date)),
  }
})
const [hero, ...articles] = formattedArticles
---

<Layout title="Blog">
		<section class="main-content">
		  <div class="container">
			<Hero article={hero} />
			<div class="articles-grid">
			  {articles.map((article, index) => (
			  <Article article={article} bordered={index !==articles.length - 1} />
			  ))}
			</div>
		  </div>
		</section>
</Layout>